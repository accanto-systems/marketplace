description: descriptor for voice-service
properties:
  deployment_location:
    type: string
    default: core-provider
    required: true
  mgmt_infra_name:
    type: string
    default: mgmt-provider
    required: true
  voice_network_id:
    read-only: true
    value: ${voice_infra.voice_network_id}
  voice_security_group_id:
    read-only: true
    value: ${voice_infra.voice_security_group_id}
  voice_service_access_ip:
    type: string
    read-only: true
    value: ${gateway.voice_address}
composition:
  voice_infra:
    properties:
      deploymentLocation:
        value: ${deployment_location}
      resourceManager:
        value: brent
    type: $lmctl:/contains:/infra:/descriptor_name
  voice_server:
    properties:
      deploymentLocation:
        value: ${deployment_location}
      gw_address:
        value: ${gateway.internal_address}
      voice_network:
        value: ${voice_infra.internal_network_id}
      voice_security_group:
        value: ${voice_infra.internal_security_group_id}
      mgmt_infra_name:
        value: ${mgmt_infra_name}
      voice_cidr:
        value: ${voice_infra.voice_cidr}
    type: assembly::ip-pbx::1.0
  gateway:
    properties:
      deploymentLocation:
        value: ${deployment_location}
      voice_network:
        value: ${voice_infra.voice_network_id}
      voice_security_group:
        value: ${voice_infra.voice_security_group_id}
      internal_network:
        value: ${voice_infra.internal_network_id}
      internal_security_group:
        value: ${voice_infra.internal_security_group_id}
      mgmt_infra_name:
        value: ${mgmt_infra_name}
    type: assembly::voip-gateway::1.0
references:
  mgmt_infra:
    properties:
      name:
        value: ${mgmt_infra_name}
    type: assembly::mgmt_infra_provider::1.0

