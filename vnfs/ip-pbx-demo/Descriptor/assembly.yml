description: descriptor for ip-pbx
properties:
  deploymentLocation:
    description: the name of the location for this assemblies resources to be deploy
    type: string
    default: mereen
  resourceManager:
    description: the name of the resource manager that manages the resources
    type: string
    default: brent
  instance_index:
    type: string
    value: ${instance.index}
  gw_address:
    description: if a gw is in front then pass in its private or internal ip address
    type: string
  keyname:
    type: string
    default: default
  mgmt_address:
    description: managemet ip address of this vnfc
    type: string
    read-only: true
    value: ${asterisk.mgmt_address}
  voice_network:
    type: string
    descripion: id of data network
  voice_security_group:
    description: voice security group
  voice_address:
    description: assigned ip address on voip network. This is the voip endpoint
    type: string
    read-only: true
    value: ${asterisk.voice_ip_address}
  mgmt_infra_name:
    description: managemet infrastructure instance name
    default: mgmt
  voice_cidr:
    type: string
    default: 10.220.217.113/24
    required: true
  # an infrastructure key with name "key1" (which must have been created using the Brent API [brent]/api/resource-manager/infrastructure-keys/shared)
  input_key:
    type: key
    value: key1
  # an infrastructure key returned from a Brent driver (the returned property will contain the UUID of the key, as generated by Brent)
  output_key:
    type: key
    read-only: true
    value: ${asterisk.output_key}
  # for debug purposes, to show the path where the infrastructure private key is persisted by the Ansible Lifecycle Driver
  # note that this is "[property name]_path"
  input_key_path:
    type: string
    read-only: true
    value: ${asterisk.input_key_path}
  # for debug purposes, to show the name of the infrastructure key e.g. "key1" in this case
  # note that this is "[property name]_name"
  input_key_name:
    type: string
    read-only: true
    value: ${asterisk.input_key_name}
composition:
  asterisk1:
    properties:
      key_name:
        value: ${keyname}
      image_id:
        value: ippbx
      flavor:
        value: m1.small
      mgmt_network_id:
        value: 192.168.99.101
      mgmt_secgroup_id:
        value: 192.168.99.101
      voice_network_id:
        value: ${voice_network}
      voice_cidr:
        value: ${voice_cidr}
      voice_secgroup_id:
        value: ${voice_security_group}
      gw_address:
        value: ${gw_address}
      integrity_smoothing:
        value: 3
      publication_period:
        value: 60
      jumphost_ip:
        value: 192.168.99.101
      jumphost_username:
        value: accanto
      jumphost_password:
        value: accanto
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      input_key:
        value: ${input_key}
    type: $lmctl:/contains:/pbx-vnfc:/descriptor_name
    quantity: 1
  asterisk2:
    properties:
      key_name:
        value: ${keyname}
      image_id:
        value: ippbx
      flavor:
        value: m1.small
      mgmt_network_id:
        value: 192.168.99.101
      mgmt_secgroup_id:
        value: 192.168.99.101
      voice_network_id:
        value: ${voice_network}
      voice_cidr:
        value: ${voice_cidr}
      voice_secgroup_id:
        value: ${voice_security_group}
      gw_address:
        value: ${gw_address}
      integrity_smoothing:
        value: 3
      publication_period:
        value: 60
      jumphost_ip:
        value: 192.168.99.101
      jumphost_username:
        value: accanto
      jumphost_password:
        value: accanto
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      input_key:
        value: ${input_key}
    type: $lmctl:/contains:/pbx-vnfc:/descriptor_name
    quantity: 1
  asterisk3:
    properties:
      key_name:
        value: ${keyname}
      image_id:
        value: ippbx
      flavor:
        value: m1.small
      mgmt_network_id:
        value: 192.168.99.101
      mgmt_secgroup_id:
        value: 192.168.99.101
      voice_network_id:
        value: ${voice_network}
      voice_cidr:
        value: ${voice_cidr}
      voice_secgroup_id:
        value: ${voice_security_group}
      gw_address:
        value: ${gw_address}
      integrity_smoothing:
        value: 3
      publication_period:
        value: 60
      jumphost_ip:
        value: 192.168.99.101
      jumphost_username:
        value: accanto
      jumphost_password:
        value: accanto
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      input_key:
        value: ${input_key}
    type: $lmctl:/contains:/pbx-vnfc:/descriptor_name
    quantity: 1
  asterisk4:
    properties:
      key_name:
        value: ${keyname}
      image_id:
        value: ippbx
      flavor:
        value: m1.small
      mgmt_network_id:
        value: 192.168.99.101
      mgmt_secgroup_id:
        value: 192.168.99.101
      voice_network_id:
        value: ${voice_network}
      voice_cidr:
        value: ${voice_cidr}
      voice_secgroup_id:
        value: ${voice_security_group}
      gw_address:
        value: ${gw_address}
      integrity_smoothing:
        value: 3
      publication_period:
        value: 60
      jumphost_ip:
        value: 192.168.99.101
      jumphost_username:
        value: accanto
      jumphost_password:
        value: accanto
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      input_key:
        value: ${input_key}
    type: $lmctl:/contains:/pbx-vnfc:/descriptor_name
    quantity: 1
  asterisk5:
    properties:
      key_name:
        value: ${keyname}
      image_id:
        value: ippbx
      flavor:
        value: m1.small
      mgmt_network_id:
        value: 192.168.99.101
      mgmt_secgroup_id:
        value: 192.168.99.101
      voice_network_id:
        value: ${voice_network}
      voice_cidr:
        value: ${voice_cidr}
      voice_secgroup_id:
        value: ${voice_security_group}
      gw_address:
        value: ${gw_address}
      integrity_smoothing:
        value: 3
      publication_period:
        value: 60
      jumphost_ip:
        value: 192.168.99.101
      jumphost_username:
        value: accanto
      jumphost_password:
        value: accanto
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      input_key:
        value: ${input_key}
    type: $lmctl:/contains:/pbx-vnfc:/descriptor_name
    quantity: 1
designerLayout:
  description: >-
    The following information is solely used to determine the presentation of
    this Assembly Design in the LM UI. It does not form part of
    operational/behavioural description of the Assembly and should not be edited
    directly.

