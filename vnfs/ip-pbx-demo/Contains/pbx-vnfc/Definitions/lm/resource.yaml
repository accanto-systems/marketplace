name: resource::pbx-vnfc-ip-pbx-demo::1.0
description: descriptor for pbx-vnfc
properties:
  instance_name:
    description: the name of this resource instance
    value: ${instance.name}
  key_name:
    description: Openstack key
    required: true
  image_id:
    description: the image name
    value: ippbx
  flavor:
    description: Type of instance (flavor) to be used
    default: m1.small

  mgmt_network_id:
    description: mgmt network id
  mgmt_secgroup_id:
    description: mgmt secgroup id
  voice_network_id:
    description: voice network id
  voice_secgroup_id:
    description: voice secgroup id

  voice_ip_address:
    description: assigned ip address on voip network. This is the voip endpoint
    read-only: true

  mgmt_ip_address:
    read-only: true

  voice_cidr:
    required: true
  gw_address:
    description: if a gw is in front then pass in its private or internal ip address

  # properties for metrics and policies
  instanceid:
    description: this is here to get metric key, which is curretly the same as instance
      id. This will be removed soon.
    value: ${instance.id}
  integrity_smoothing:
    description: Integrity smoothing
    default: 3
  publication_period:
    description: Metric publication period in seconds
    default: 60

  # jumphost properties
  jumphost_ip:
    description: ip assigned to jumphost
  jumphost_username:
    description: jumphost username
  jumphost_password:
    description: jumphost password

  input_key:
    type: key
  input_key_as_string:
    type: string
    read-only: true
  input_key_name:
    type: string
    read-only: true
  input_key_path:
    type: string
    read-only: true
  externalId:
    type: string
  pbx_ssh_key_name:
    type: string

  infrastructure_id:
    type: string
    read-only: true

  networks:
    type: string
    default: mgmt
# private-properties:
  # this is an SSH key created by the Openstack VIM driver.
  # pbx_ssh_key:
  #   description: Name of an infrastructure key-pair to be used for compute instance
  #   type: key
  # output_key:
  #   type: key
infrastructure:
  Openstack: {}
  Kubernetes: {}
lifecycle:
  Create:
    drivers:
      kubernetes:
        selector:
          infrastructure-type:
          - 'kubernetes'
  Install:
    drivers:
      ansible:
        selector:
          infrastructure-type:
          - '*'
  Configure:
    drivers:
      ansible:
        selector:
          infrastructure-type:
          - '*'
  Integrity:
    drivers:
      ansible:
        selector:
          infrastructure-type:
          - '*'
  Start:
    drivers:
      ansible:
        selector:
          infrastructure-type:
          - '*'
  Stop:
    drivers:
      ansible:
        selector:
          infrastructure-type:
          - '*'
  Delete:
    drivers:
      kubernetes:
        selector:
          infrastructure-type:
          - 'kubernetes'
metrics:
  h_integrity:
    type: "metric::integrity"
    publication-period: "10"
policies:
  heal:
    metric: "h_integrity"
    type: "policy::heal"
    properties:
      smoothing:
        value: ${integrity_smoothing}
