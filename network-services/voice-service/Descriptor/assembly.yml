name: assembly::voice-service::1.0
description: Voice Service
properties:
  deploymentLocation:
    type: string
    default: devstack
  resourceManager:
    type: string
    default: defaultrm
  keyname:
    type: string
    description: name of the openstack keyname
    require: true
  voice_service_ipaddress:
    description: the ip address of the endpoint for the voice service
    type: string
    read-only: true
    value: ${gateway.external_address}
composition:
  gateway:
    properties:
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      keyname:
        value: ${keyname}
      mgmt_network:
        value: ${base.mgmt_networkid}
      external_network:
        value: ${base.voice_networkid}
      internal_network:
        value: ${internal.networkid}
      jumphost_ip:
        value: ${base.jumphost_ip}
      jumphost_username:
        value: ${base.jumphost_username}
      jumphost_password:
        value: ${base.jumphost_password}
    type: assembly::voip-gateway::1.0
    quantity: 1
  voip-server:
    properties:
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      keyname:
        value: ${keyname}
      mgmt_network:
        value: ${base.mgmt_networkid}
      data_network:
        value: ${internal.networkid}
      jumphost_ip:
        value: ${base.jumphost_ip}
      jumphost_username:
        value: ${base.jumphost_username}
      jumphost_password:
        value: ${base.jumphost_password}
    type: assembly::ip-pbx::1.0
    cluster:
      initial-quantity: 1
      minimum-nodes: 1
      maximum-nodes: 10
      scaling-increment: 1
  internal:
    properties:
      deploymentLocation:
        value: ${deploymentLocation}
      resourceManager:
        value: ${resourceManager}
      subnet:
        value: "10.0.0.0/24"
    type: assembly::network::1.0
references:
  base:
    properties:
      name:
        value: base
    type: assembly::base::0.1
relationships:
  manageDispatchList:
    properties:
      ipaddr:
        value: ${source.data_address}
      port:
        value: '5060'
    source-state: Active
    target-state: Active
    source-state-modifier: post
    target-state-modifier: post
    lifecycle:
      Create:
      - target.addToDispatchList
      Cease:
      - target.deleteFromDispatchList
    source-capabilities:
    - voip-server.poolNode
    target-requirements:
    - gateway.poolController
policies:
  scaleVoipServer:
    properties:
      scaleOut_threshold:
        value: 58
      scaleIn_threshold:
        value: 32
      smoothing:
        value: 3
    type: policy::scale
    metric: gateway.h_load
    target: voip-server
